.. _tutsparse:

======
Sparse
======

This is an admittedly too short discussion on the use of sparse matrices within Theano. 
Some aspects are still not well documented regarding for instance how we take care of the
gradient. The following may at least be mentioned: There are 2 types of gradient 
calculations that may be involved in sparse operations. The *full gradient* computes a 
gradient for all values even if they are equal to 0 whereas and the *structured gradient*
returns a gradient only for values that are not equal to 0. You need to check the code to
know which gradient exactly an op implements.

More detailed documentation may be found in the :ref:`Sparse Library Reference <libdoc_sparse>`.

Here is a small example:

.. code-block:: python

    import theano
    import theano.tensor as T
    import scipy.sparse as sp
    import theano.sparse as S
    import numpy as np

    x = S.csr_matrix ('x')
    #x = T.matrix ('x')
    y = T.matrix ('y')
    z = S.dot (x, y)
    f = theano.function ([x, y], z)

    #a = np.array ([[0, 1], [1, 0], [1, 0], [0, 1]], dtype=np.float32)
    a = sp.coo_matrix (([1] * 4, (range (4), [0, 1, 1, 0])), dtype=np.float32)

    b = np.array ([[10, 11], [12, 13]], dtype=np.float32)

    print f (a, b)
